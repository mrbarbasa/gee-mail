<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>GeeMail</title>
		<script src="js/lib/jquery-1.11.1.min.js"></script>
		<script src="js/lib/jquery-ui/jquery-ui.min.js"></script>
		<script src="js/lib/moment.min.js"></script>
		<script src="js/mail-generator.js"></script>
		<link href="js/lib/jquery-ui/jquery-ui.min.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet" media="screen">
		<script>
			$(document).ready(function() {

				var gee = window.geemails;

				function getInboxTotal() {
					$("#inboxTotal").text(gee.length);
				}

				function addRow(sectionRows, mail) {
					sectionRows.append("<li>"
						+ "<h4>" 
						+ "<span class='sender'>" + mail.sender + "</span>"
						+ "---" 
						+ "<span class='subject'>" + mail.subject + "</span>"
						+ "---" 
						+ "<span class='date'>" + moment(mail.date).format("LL") + "</span>"
						+ "</h4>"
						+ "<div><p>" 
						+ mail.body 
						+ "</p></div>"
						+ "</li>"
					);
				}

				function populateRows() {
					var importantRows = $("<ul></ul>"),
							starredRows = $("<ul></ul>"),
							otherRows = $("<ul></ul>");
					for (var i = 0, l = gee.length; i < l; i++) {
						switch(gee[i].section) {
							case "important":
								addRow(importantRows, gee[i]);
								break;
							case "starred":
								addRow(starredRows, gee[i]);
								break;
							case "other":
								addRow(otherRows, gee[i]);
								break;
							default:
								console.log("Gee, the array is empty.");
						}
					}
					$("#importantContent").append(importantRows);
					$("#starredContent").append(starredRows);
					$("#otherContent").append(otherRows);
				}

				function initAccordions() {
					var options = { 
						animate: 200,
						collapsible: true, // Collapse the active section
						active: false, // Collapse all panels by default
						heightStyle: "content"
					};
					$(".sectionPanel").accordion(options);
					$(".sectionContent ul").accordion(options);
				}

				function refreshInbox() {
					var mail = gee[gee.length - 1];
					// console.log(gee.length + " --- " + mail.section);
					switch(mail.section) {
						case "important":
							addRow($("#importantContent ul"), mail);
							$("#importantContent ul").accordion("refresh");
							break;
						case "starred":
							addRow($("#starredContent ul"), mail);
							$("#starredContent ul").accordion("refresh");
							break;
						case "other":
							addRow($("#otherContent ul"), mail);
							$("#otherContent ul").accordion("refresh");
							break;
						default:
							console.log("This email has not been marked.");
					}
				}

				function generateMessages() {
					// Generate a new email
					var message = getNewMessage();
					// Add it to the array of emails
					gee.push(message);
					// Set the Inbox total to the new array length
					getInboxTotal();
					// Display the newly generated email in its section
					refreshInbox();
					// Recursively call this function after 3 seconds
					setTimeout(generateMessages, 3000);
				}

				getInboxTotal();
				populateRows();
				initAccordions();
				setTimeout(generateMessages, 3000);
				
			});
		</script>
	</head>
	<body>
		<header>
			<h1>GeeMail</h1>
		</header>
		<section>
			<div class="container" id="sidebar">
				<!-- <span id="compose">Compose</span> -->
				<h3>Inbox (<span id="inboxTotal"></span>)</h3>
			</div>
			<div class="container" id="main">

				<div class="sectionPanel">
					<!-- Another div wraps around sectionHeader -->
					<div class"sectionHeader" id="importantHeader">
						<div class="sectionTitle" id="importantTitle">
							<span>Important</span>
						</div>
						<!-- <div class="sectionOther" id="importantOther">
							<div>
								<span id="importantCounts">
									<b>1</b>-<b>4</b> of <b>8</b>
								</span>
							</div>
							<div id="importantOptions">
								<span class="shouldBeImage">-</span>
							</div>
						</div> -->
					</div>
					<div class="sectionContent" id="importantContent">
						<!-- Another div wraps around ul -->
					</div>
				</div>

				<div class="sectionPanel">
					<div class"sectionHeader" id="starredHeader">
						<div class="sectionTitle" id="starredTitle">
							<span>Starred</span>
						</div>
						<!-- <div class="sectionOther" id="starredOther">
							<div>
								<span id="starredCounts">
									<b>1</b>-<b>4</b> of <b>8</b>
								</span>
							</div>
							<div id="starredOptions">
								<span class="shouldBeImage">-</span>
							</div>
						</div> -->
					</div>
					<div class="sectionContent" id="starredContent">
					</div>
				</div>

				<div class="sectionPanel">
					<div class"sectionHeader" id="allElseHeader">
						<div class="sectionTitle" id="allElseTitle">
							<span>Everything else</span>
						</div>
						<!-- <div class="sectionOther" id="allElseOther">
							<div>
								<span id="allElseCounts">
									<b>1</b>-<b>4</b> of <b>8</b>
								</span>
							</div>
							<div id="allElseOptions">
								<span class="shouldBeImage">-</span>
							</div>
						</div> -->
					</div>
					<div class="sectionContent" id="otherContent">
					</div>
				</div>

			</div>
		</section>
		<footer>
		</footer>
	</body>
</html>